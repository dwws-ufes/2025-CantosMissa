<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:f="http://xmlns.jcp.org/jsf/core"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:p="http://primefaces.org/ui"
        xmlns:adm="http://github.com/adminfaces"
        template="/WEB-INF/templates/template.xhtml">

   <ui:define name="title">
      <h:outputText value="#{msgsCore['viewMusic.title']}" />
   </ui:define>

   <ui:define name="body">
      <adm:breadcrumb link="/core/viewMusic/index" title="#{msgsCore['viewMusic.title']}" />

      <h:outputScript name="js/chords.js" target="head" />

      <h:form id="form">
         <p:panel header="#{msgsCore['viewMusic.panel.title']}" styleClass="card no-border">
            <p:panelGrid columns="2" cellpadding="5" layout="grid" styleClass="ui-fluid card" columnClasses="ui-grid-col-4,ui-grid-col-8">

               <p:outputLabel value="#{msgsCore['manageMusics.field.title']}" />
               <h:outputText value="#{viewMusicController.selectedEntity.title}" />

               <p:outputLabel value="#{msgsCore['manageMusics.field.artist']}" />
               <h:outputText value="#{viewMusicController.selectedEntity.artist.name}" />

               <p:outputLabel value="#{msgsCore['manageMusics.field.musicKey']}" />
               <h:panelGroup layout="block" styleClass="key-controls" style="text-align:left; margin-bottom: 1rem;">
                  <!-- Botão para diminuir 1/2 tom -->
                  <p:commandButton icon="pi pi-minus"
                                   onclick="transpose(-1);"
                                   type="button"
                                   styleClass="ui-button-secondary"
                                   title="Diminuir ½ tom"
                                   style="margin-right: 0.5rem; width: 2rem" />

                  <!-- Tom atual clicável -->
                  <h:outputText id="keyLabel"
                                value="#{viewMusicController.selectedEntity.musicKey.value}"
                                styleClass="key-label"
                                style="font-weight: bold; font-size: 1.2rem; cursor: pointer; font-family: monospace;"
                                onclick="toggleKeySelector()" />

                  <!-- Botão para aumentar 1/2 tom -->
                  <p:commandButton icon="pi pi-plus"
                                   onclick="transpose(1);"
                                   type="button"
                                   styleClass="ui-button-secondary"
                                   title="Aumentar ½ tom"
                                   style="margin-left: 0.5rem; width: 2rem" />

                  <!-- Seletor de tom -->
                  <div id="keySelector" style="display:none; text-align: center; margin-bottom: 1rem;">
                     <ui:repeat value="#{viewMusicController.availableKeys}" var="key">
                        <p:commandLink value="#{key.value}"
                                       onclick="transposeTo('#{key}'); return false;"
                                       style="margin: 0 0.3rem; font-weight: bold;" />
                     </ui:repeat>
                  </div>
               </h:panelGroup>

               <p:outputLabel value="#{msgsCore['manageMusics.field.liturgicalSeason']}" />
               <h:outputText value="#{viewMusicController.selectedEntity.liturgicalSeason.value}" />

               <p:outputLabel value="#{msgsCore['manageMusics.field.songType']}" />
               <h:outputText value="#{viewMusicController.selectedEntity.songType.value}" />

               <p:outputLabel value="#{msgsCore['manageMusics.field.youtubeLink']}" />
               <h:outputLink value="#{viewMusicController.selectedEntity.youtubeLink}" target="_blank">
                  <h:outputText value="#{viewMusicController.selectedEntity.youtubeLink}" />
               </h:outputLink>

               <p:outputLabel value="#{msgsCore['manageMusics.field.chords']}" />
               <h:outputText id="chordsDisplay" value="#{viewMusicController.selectedEntity.chords}" escape="false"
                             style="font-family: monospace; white-space: pre-wrap;" />
            </p:panelGrid>
         </p:panel>
      </h:form>
      <style>
         .chord {
            color: #0066cc;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
         }
         .chord:hover {
            color: #ff6600;
         }
      </style>
   </ui:define>
</ui:composition>
